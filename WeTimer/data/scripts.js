var netIP="wetimer.local",cServo,cServoOK,testModeEnCours,celluleEnCours,delaiEnCours,changeTimeoutID,isTouchDevice,ws,wsm_max_len,switch_on,switch_off,switch_0,switch_1,status,ssid,pwd,apConfigChange,getVersionOK,pageEnCours,description,netDevURL="http://"+netIP,refreshTimeoutID=0,tblDelai=new Array(10),pServo=new Array(3);pServo[0]=new Array(11),pServo[1]=new Array(11),pServo[2]=new Array(11),cServo=new Array(3),cServo[0]=new Array(4),cServo[1]=new Array(4),cServo[2]=new Array(4),cServoOK=!1,testModeEnCours=0,celluleEnCours=null,delaiEnCours=null,changeTimeoutID=null,isTouchDevice="ontouchstart"in document.documentElement,ws=null,wsm_max_len=4096,switch_on=0,switch_off=1,switch_0=switch_off,switch_1=switch_off,status=null,ssid="",pwd="",apConfigChange=!1,getVersionOK=!1,pageEnCours=1,description="";function sleep(e){return new Promise(t=>setTimeout(t,e))}function index_beforeunload(){localStorage.setItem("unloadTime",JSON.stringify(new Date))}async function index_onload(){if(index_resize(),XMLHttpRequest_get("/getversion"),XMLHttpRequest_get("/getstatus"),XMLHttpRequest_get("/gettempvol"),ws_connect(),isReloadOrOnload()=="reload"){var e=localStorage.getItem("pageEnCours");e!==null&&(pageEnCours=e,pageEnCours==2&&showSettings())}}function isReloadOrOnload(){let t=new Date,e=localStorage.getItem("unloadTime");if(e===null)return"onload";e=new Date(JSON.parse(e));let n=t.getTime()-e.getTime();return n<3e3?"reload":"onload"}function reloadPage1(){pageEnCours=1,localStorage.setItem("pageEnCours",pageEnCours),document.location.reload(!0)}function index_onclick(){menu.classList.contains("noshow")||menu.classList.add("noshow")}function index_ondblclick(){height=window.innerHeight,width=window.innerWidth;var t=parseFloat(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=window.getComputedStyle(document.body).getPropertyValue("font-family"),s=window.getComputedStyle(document.getElementById("description_page1",null)).getPropertyValue("font-size"),o=window.getComputedStyle(document.getElementById("tsetup",null)).getPropertyValue("font-size"),e="",e="Hauteur   = "+String(height);e+=`
Largeur   = `+String(width),e+=`
Font name = `+String(n),e+=`
Font size = `+String(t)+"px",e+=`
fSize2 = `+s,e+=`
fSize3 = `+o,alert(e)}function index_resize(){height=window.innerHeight,width=window.innerWidth,height<730?(pied_page=document.getElementById("pied_page"),pied_page.style.bottom="",pied_page.style.top=730-pied_page.offsetHeight+"px"):(pied_page.style.top="",pied_page.style.bottom="0")}function XMLHttpRequest_get(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==4&&(t.status==200||t.status==0?XMLHttpResult(e,t.responseXML,t.responseText):alert("XMLHttpRequest_get("+e+") : Error "+t.status+`
`+t.responseText))},location.protocol=="file:"?uri=netDevURL+e:uri=e,t.open("GET",uri,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send()}async function XMLHttpRequest_post(e){var n,s,o,i,a,r,c,l,d,u,t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==4&&(t.status==200||t.status==0?XMLHttpResult(e,t.responseXML,t.responseText):alert("XMLHttpRequest_post() : Error "+t.status+`
`+t.responseText))},location.protocol=="file:"?postURI=netDevURL+e:postURI=e,n="",e=="/settempvol"?(d=document.getElementById("tempVol").value,n="tempvol="+d,t.open("POST",postURI,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)):e=="/setconfig"?(n+="json={",n+='"delai":"'+JSON.stringify(tblDelai)+'",',n+='"pservo":"'+JSON.stringify(pServo)+'"}',t.open("POST",postURI,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)):e=="/setservoconfig"?(n+="json={",n+='"cservo":"'+JSON.stringify(cServo)+'",',n+='"pservo":"'+JSON.stringify(pServo)+'"}',t.open("POST",postURI,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)):e=="/servotest"||e=="/servopos"?(e=="/servotest"?(o=getTestMode(),s=document.getElementById("servoNum").value,i=document.getElementById("course1").value,a=document.getElementById("course2").value,r=document.getElementById("pwm1").value,c=document.getElementById("pwm2").value,l=document.getElementById("confRange").value):(o=0,s=document.getElementById("sNum").innerText,i=cServo[s][0],a=cServo[s][1],r=cServo[s][2],c=cServo[s][3],l=document.getElementById("posAdjust").value),n="mode="+o,n+="&servonum="+s,n+="&limit1="+i,n+="&limit2="+a,n+="&pwm1="+r,n+="&pwm2="+c,n+="&val="+l,t.open("POST",postURI,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n)):e=="/uploadconfig"?(u=document.getElementById("fileSelect").files[0],n=await readFile(u),t.open("POST",postURI,!0),t.setRequestHeader("Content-Type","text/plain"),t.send(n)):e=="/setdescription"&&(n+='{"description":"'+escapeXML(description)+'"}',t.open("POST",postURI,!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.send(n))}async function readFile(e){let t=await new Promise(t=>{let n=new FileReader;n.onload=e=>t(n.result),n.readAsArrayBuffer(e)});return t}function XMLHttpResult(e,t){if(t!=null)switch(e){case"/getversion":updateVersion(t);break;case"/getstatus":updateStatus(t);break;case"/gettempvol":case"/settempvol":updateTempVol(t);break;case"/getconfig":updateConfig(t);break;case"/getservoconfig":updateServoConfig(t);break;case"/getjson":break;case"/uploadconfig":result=unescapeXML(t.getElementsByTagName("uploadconfig")[0].innerHTML),alert(result=="OK"?"Fichier de configuration rechargé dans la minuterie avec succès.":`Erreur lors de l'envoi du fichier de configuration à la minuterie :
`+result),XMLHttpRequest_get("/getversion"),XMLHttpRequest_get("/getconfig"),XMLHttpRequest_get("/getservoconfig"),XMLHttpRequest_get("/gettempvol");break;case"/setdescription":result=unescapeXML(t.getElementsByTagName("setdescription")[0].innerHTML),result!="OK"&&alert(`Erreur lors de l'envoi de la description à la minuterie :
`+result),XMLHttpRequest_get("/getversion")}}function updateVersion(e){var n,s=document.getElementById("pversion1"),o=document.getElementById("pversion2"),t=e.getElementsByTagName("version")[0].childNodes[0].nodeValue;s.innerText=t.split(".",2).join("."),o.innerText=t,n=document.getElementById("timer_ssid"),ssid=e.getElementsByTagName("ssid")[0].innerHTML,pwd=e.getElementsByTagName("pwd")[0].innerHTML,n.innerText=ssid,description=unescapeXML(e.getElementsByTagName("description")[0].innerHTML),document.getElementById("description_page1").innerText=description,document.getElementById("description_page2").innerText=description,getVersionOK=!0}function updateStatus(e){var t,n,s,o,i=document.getElementById("timer_status");status=e.getElementsByTagName("status")[0].childNodes[0].nodeValue,i.innerText=status,status!="PARC"?(switch_0==switch_off?document.getElementById("led0").style.backgroundImage="url(images/ledrouge.svg)":document.getElementById("led0").style.backgroundImage="url(images/ledverte.svg)",switch_1==switch_off?document.getElementById("led1").style.backgroundImage="url(images/ledrouge.svg)":document.getElementById("led1").style.backgroundImage="url(images/ledverte.svg)"):(document.getElementById("led0").style.backgroundImage="url(images/ledeteinte.svg)",document.getElementById("led1").style.backgroundImage="url(images/ledeteinte.svg)"),s=document.getElementById("duree_vol"),o=e.getElementsByTagName("dureevol")[0].childNodes[0].nodeValue,s.innerText=o,t=document.getElementById("batterie"),n=e.getElementsByTagName("tension")[0].childNodes[0].nodeValue,tension_float=parseFloat(n),tension_float>2.5?t.innerHTML="<p>"+n+"v</p>":t.innerHTML="",tension_float<=2.5?t.style.backgroundImage="url(images/batterie0.svg)":tension_float<3.55?t.style.backgroundImage="url(images/batterie4.svg)":tension_float<3.88?t.style.backgroundImage="url(images/batterie3.svg)":tension_float<3.95?t.style.backgroundImage="url(images/batterie2.svg)":t.style.backgroundImage="url(images/batterie1.svg)",autoRefreshStatus()}function autoRefreshStatus(){var e=1e3;clearTimeout(refreshTimeoutID),refreshTimeoutID=setTimeout(function(){XMLHttpRequest_get("/getstatus")},e)}function updateTempVol(e){var t=document.getElementById("tempVol"),n=e.getElementsByTagName("tempvol")[0].childNodes[0].nodeValue;t.value=parseInt(n/100),calculTemps("tempVol","tempsMinutes")}function updateConfig(e){var t,n,s,i=document.getElementById("setup_table"),o=e.getElementsByTagName("delai");o.length!=10&&document.location.reload(!0);for(const e of o)num=Number(e.getElementsByTagName("num")[0].innerHTML),val=Number(e.getElementsByTagName("val")[0].innerHTML),tblDelai[num]=val;s=e.getElementsByTagName("pservo"),s.length!=33&&document.location.reload(!0);for(const e of s)num=Number(e.getElementsByTagName("num")[0].innerHTML),pos=Number(e.getElementsByTagName("pos")[0].innerHTML),val=Number(e.getElementsByTagName("microsecondes")[0].innerHTML),pServo[num][pos]=val;t="",n=0,t+="<tr>",t+="  <td class='tdCol1' id='posName_0'>Parc</td>",t+="  <td>&nbsp;</td>",t+="  <td class='center'><image class='tbl_leds' src='images/leds00.svg' /></td>",t+="  <td class='cellServo' id='servo_0_0' onclick='adjustServo(this)'>"+pServo[0][0]+"</td>",t+="  <td class='cellServo' id='servo_1_0' onclick='adjustServo(this)'>"+pServo[1][0]+"</td>",t+="  <td class='cellServo' id='servo_2_0' onclick='adjustServo(this)'>"+pServo[2][0]+"</td>",t+=`</tr>
`,t+="<tr>",t+="  <td class='tdCol1'>Armement</td>",t+="  <td>&nbsp;</td>",t+="  <td class='center'><image class='tbl_leds' src='images/leds21.svg' /></td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+=`</tr>
`,t+="<tr>",t+="  <td class='tdCol1' id='posName_1'>Treuil montée</td>",t+="  <td class='cellDelai' id='delai_0' onclick='inputDelai(this)'>"+(tblDelai[0]/100).toFixed(2)+"</td>",t+="  <td class='center'><image class='tbl_leds' src='images/leds21.svg' /></td>",t+="  <td class='cellServo' id='servo_0_1' onclick='adjustServo(this)'>"+pServo[0][1]+"</td>",t+="  <td class='cellServo' id='servo_1_1' onclick='adjustServo(this)'>"+pServo[1][1]+"</td>",t+="  <td class='cellServo' id='servo_2_1' onclick='adjustServo(this)'>"+pServo[2][1]+"</td>",t+=`</tr>
`,t+="<tr>",t+="  <td class='tdCol1' id='posName_2'>Treuil virage</td>",t+="  <td>&nbsp;</td>",t+="  <td class='center'><image class='tbl_leds' src='images/leds11.svg' /></td>",t+="  <td class='cellServo' id='servo_0_2' onclick='adjustServo(this)'>"+pServo[0][2]+"</td>",t+="  <td class='cellServo' id='servo_1_2' onclick='adjustServo(this)'>"+pServo[1][2]+"</td>",t+="  <td class='cellServo' id='servo_2_2' onclick='adjustServo(this)'>"+pServo[2][2]+"</td>",t+=`</tr>
`,t+="<tr>",t+="  <td class='tdCol1' id='posName_3'>Dévérouillé</td>",t+="  <td>&nbsp;</td>",t+="  <td class='center'><image class='tbl_leds' src='images/leds22.svg' /></td>",t+="  <td class='cellServo' id='servo_0_3' onclick='adjustServo(this)'>"+pServo[0][3]+"</td>",t+="  <td class='cellServo' id='servo_1_3' onclick='adjustServo(this)'>"+pServo[1][3]+"</td>",t+="  <td class='cellServo' id='servo_2_3' onclick='adjustServo(this)'>"+pServo[2][3]+"</td>",t+=`</tr>
`,t+="<tr>",t+="  <td class='tdCol1'>Larguage</td>",t+="  <td class='center'><image class='tbl_leds' src='images/leds10.svg' /></td>",t+="  <td class='cellValue'>0</td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+=`</tr>
`,n+=tblDelai[1]/100,t+="<tr>",t+="  <td class='tdCol1' id='posName_4'>Pitchup</td>",t+="  <td class='cellDelai' id='delai_1' onclick='inputDelai(this)'>"+(tblDelai[1]/100).toFixed(2)+"</td>",t+="  <td class='cellValue'>"+n.toFixed(2)+"</td>",t+="  <td class='cellServo' id='servo_0_4' onclick='adjustServo(this)'>"+pServo[0][4]+"</td>",t+="  <td class='cellServo' id='servo_1_4' onclick='adjustServo(this)'>"+pServo[1][4]+"</td>",t+="  <td class='cellServo' id='servo_2_4' onclick='adjustServo(this)'>"+pServo[2][4]+"</td>",t+=`</tr>
`,n+=tblDelai[2]/100,t+="<tr>",t+="  <td class='tdCol1' id='posName_5'>Montée 1</td>",t+="  <td class='cellDelai' id='delai_2' onclick='inputDelai(this)'>"+(tblDelai[2]/100).toFixed(2)+"</td>",t+="  <td class='cellValue'>"+n.toFixed(2)+"</td>",t+="  <td class='cellServo' id='servo_0_5' onclick='adjustServo(this)'>"+pServo[0][5]+"</td>",t+="  <td class='cellServo' id='servo_1_5' onclick='adjustServo(this)'>"+pServo[1][5]+"</td>",t+="  <td class='cellServo' id='servo_2_5' onclick='adjustServo(this)'>"+pServo[2][5]+"</td>",t+=`</tr>
`,n+=tblDelai[3]/100,t+="<tr>",t+="  <td class='tdCol1' id='posName_6'>Montée 2</td>",t+="  <td class='cellDelai' id='delai_3' onclick='inputDelai(this)'>"+(tblDelai[3]/100).toFixed(2)+"</td>",t+="  <td class='cellValue'>"+n.toFixed(2)+"</td>",t+="  <td class='cellServo' id='servo_0_6' onclick='adjustServo(this)'>"+pServo[0][6]+"</td>",t+="  <td class='cellServo' id='servo_1_6' onclick='adjustServo(this)'>"+pServo[1][6]+"</td>",t+="  <td class='cellServo' id='servo_2_6' onclick='adjustServo(this)'>"+pServo[2][6]+"</td>",t+=`</tr>
`,n+=tblDelai[4]/100,t+="<tr>",t+="  <td class='tdCol1' id='posName_7'>Bunt</td>",t+="  <td class='cellDelai' id='delai_4' onclick='inputDelai(this)'>"+(tblDelai[4]/100).toFixed(2)+"</td>",t+="  <td class='cellValue'>"+n.toFixed(2)+"</td>",t+="  <td class='cellServo' id='servo_0_7' onclick='adjustServo(this)'>"+pServo[0][7]+"</td>",t+="  <td class='cellServo' id='servo_1_7' onclick='adjustServo(this)'>"+pServo[1][7]+"</td>",t+="  <td class='cellServo' id='servo_2_7' onclick='adjustServo(this)'>"+pServo[2][7]+"</td>",t+=`</tr>
`,n+=tblDelai[5]/100,t+="<tr>",t+="  <td class='tdCol1' id='posName_8'>Plané 1</td>",t+="  <td class='cellDelai' id='delai_5' onclick='inputDelai(this)'>"+(tblDelai[5]/100).toFixed(2)+"</td>",t+="  <td class='cellValue'>"+n.toFixed(2)+"</td>",t+="  <td class='cellServo' id='servo_0_8' onclick='adjustServo(this)'>"+pServo[0][8]+"</td>",t+="  <td class='cellServo' id='servo_1_8' onclick='adjustServo(this)'>"+pServo[1][8]+"</td>",t+="  <td class='cellServo' id='servo_2_8' onclick='adjustServo(this)'>"+pServo[2][8]+"</td>",t+=`</tr>
`,n+=tblDelai[6]/100,t+="<tr>",t+="  <td class='tdCol1' id='posName_9'>Plané 2</td>",t+="  <td class='cellDelai' id='delai_6' onclick='inputDelai(this)'>"+(tblDelai[6]/100).toFixed(2)+"</td>",t+="  <td class='cellValue'>"+n.toFixed(2)+"</td>",t+="  <td class='cellServo' id='servo_0_9' onclick='adjustServo(this)'>"+pServo[0][9]+"</td>",t+="  <td class='cellServo' id='servo_1_9' onclick='adjustServo(this)'>"+pServo[1][9]+"</td>",t+="  <td class='cellServo' id='servo_2_9' onclick='adjustServo(this)'>"+pServo[2][9]+"</td>",t+=`</tr>
`,n=tblDelai[7]/100,t+="<tr>",t+="  <td class='tdCol1' id='posName_10'>DT</td>",t+="  <td class='cellValue noInput' id='delai_7'>"+(tblDelai[7]/100).toFixed(0)+"</td>",t+="  <td class='cellValue'>"+n.toFixed(0)+"</td>",t+="  <td class='cellServo' id='servo_0_10' onclick='adjustServo(this)'>"+pServo[0][10]+"</td>",t+="  <td class='cellServo' id='servo_1_10' onclick='adjustServo(this)'>"+pServo[1][10]+"</td>",t+="  <td class='cellServo' id='servo_2_10' onclick='adjustServo(this)'>"+pServo[2][10]+"</td>",t+=`</tr>
`,n+=tblDelai[8]/100,t+="<tr>",t+="  <td class='tdCol1'>Retour parc</td>",t+="  <td class='cellDelai' id='delai_8' onclick='inputDelai(this)'>"+(tblDelai[8]/100).toFixed(2)+"</td>",t+="  <td class='cellValue'>"+n.toFixed(2)+"</td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+=`</tr>
`,t+="<tr>",t+="  <td class='tdCol1 disabled'>Refermeture crochet</td>",t+="  <td class='cellDelai disabled' id='delai_9' onclick=';'>"+(tblDelai[9]/100).toFixed(2)+"</td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+="  <td>&nbsp;</td>",t+=`</tr>
`,i.innerHTML=t}function updateServoConfig(e){var t=e.getElementsByTagName("cservo");t.length!=12&&document.location.reload(!0);for(const e of t)num=Number(e.getElementsByTagName("num")[0].innerHTML),conf=Number(e.getElementsByTagName("conf")[0].innerHTML),val=Number(e.getElementsByTagName("val")[0].innerHTML),cServo[num][conf]=val;cServoOK=!0}function changeVal(e,t){var s=document.getElementById(e),o=Number(s.value);o+=t,forceInterval(s,o,Number(s.min),Number(s.max))}function calculTemps(e,t,n=!0){var s,i,a,r,o=document.getElementsByName(e);o.length>0&&(n?(s=parseInt(o[0].value,10)):(s=parseFloat(o[0].value)),i=Math.floor(s/60),r=parseFloat(s-i*60).toFixed(2),a=document.getElementById(t),a!=null&&(a.textContent=i+" minute(s) "+r+" seconde(s)"))}function showSettings(){page_1=document.getElementById("page_1"),page_2=document.getElementById("page_2"),page_1.classList.contains("noshow")?(page_1.classList.remove("noshow"),page_2.classList.add("noshow"),pageEnCours=1):(page_1.classList.add("noshow"),page_2.classList.remove("noshow"),XMLHttpRequest_get("/getconfig"),pageEnCours=2),localStorage.setItem("pageEnCours",pageEnCours)}async function adjustServo(e){celluleEnCours=e;var n,s,o=e.id.split("_"),t=Number(o[1]),i=Number(o[2]),a=document.getElementById("posName_"+String(i)).innerText,r=t+1;for(document.getElementById("input_position_title").innerHTML="servo<span id='sNum'>"+r+"</span><br /><span class='nobold'>Position[<span id='pNum'>"+i+"</span>] "+a+"</span>",cServoOK=!1,XMLHttpRequest_get("/getservoconfig");!cServoOK;)await sleep(100);cServoOK=!1,n=document.getElementById("posAdjust"),n.min=cServo[t][0],n.max=cServo[t][1],n.value=parseInt(e.innerText),s=document.getElementById("posRange"),s.min=cServo[t][0],s.max=cServo[t][1],s.value=parseInt(e.innerText),document.getElementById("posLimit1").innerText=cServo[t][0],document.getElementById("posLimit2").innerText=cServo[t][1],XMLHttpRequest_post("/servopos"),dialog_mask=document.getElementById("dialog_mask"),input_position=document.getElementById("input_position"),dialog_mask.classList.remove("noshow"),input_position.classList.remove("noshow")}function positionOK(){var t,n,s=document.getElementById("posAdjust"),e=parseInt(s.value);celluleEnCours.innerText=e,t=Number(document.getElementById("sNum").innerText),n=Number(document.getElementById("pNum").innerText),pServo[t][n]=e,XMLHttpRequest_post("/setconfig"),dialogHide()}function showPosRangeVal(e){document.getElementById("posAdjust").value=e}function setPosRangeVal(e){document.getElementById("posRange").value=e,document.getElementById("posRange").text=e,XMLHttpRequest_post("/servopos")}async function configServo(e){for(document.getElementById("input_servo_title").innerText="Amplitude servo"+e,cServoOK=!1,XMLHttpRequest_get("/getservoconfig");!cServoOK;)await sleep(100);cServoOK=!1,e=e-1,document.getElementById("servoNum").value=e,document.getElementById("oldCourse1").value=Number(cServo[e][0]),document.getElementById("oldCourse2").value=Number(cServo[e][1]),document.getElementById("oldPwm1").value=Number(cServo[e][2]),document.getElementById("oldPwm2").value=Number(cServo[e][3]),document.getElementById("course1").value=Number(cServo[e][0]),changePlageServo("course1"),document.getElementById("course2").value=Number(cServo[e][1]),changePlageServo("course2"),document.getElementById("pwm1").value=Number(cServo[e][2]),document.getElementById("pwm2").value=Number(cServo[e][3]),document.getElementById("sliderVal").checked=!0,changeTestMode();var t=Math.round((Number(cServo[e][0])+Number(cServo[e][1]))/2);showRangeVal(t),document.getElementById("confRange").value=t,dialog_mask=document.getElementById("dialog_mask"),input_servo=document.getElementById("input_servo"),dialog_mask.classList.remove("noshow"),input_servo.classList.remove("noshow"),XMLHttpRequest_post("/servotest")}function inputDelai(e){switch(celluleEnCours=e,document.getElementById("delaiSec").value=parseFloat(e.innerText),calculTemps("delaiSec","delaiMinutes",!1),args=e.id.split("_"),delaiEnCours=Number(args[1]),delaiEnCours){case 0:document.getElementById("input_delai_title").innerText="Délai d'armement";break;case 1:document.getElementById("input_delai_title").innerText="Délai pitchup";break;case 2:document.getElementById("input_delai_title").innerText="Délai montée 1";break;case 3:document.getElementById("input_delai_title").innerText="Délai montée 2";break;case 4:document.getElementById("input_delai_title").innerText="Délai bunt";break;case 5:document.getElementById("input_delai_title").innerText="Délai plané 1";break;case 6:document.getElementById("input_delai_title").innerText="Délai plané 2";break;case 7:document.getElementById("input_delai_title").innerText="Durée totale du vol";break;case 8:document.getElementById("input_delai_title").innerText="Délai retour parc";break}dialog_mask=document.getElementById("dialog_mask"),input_delai=document.getElementById("input_delai"),dialog_mask.classList.remove("noshow"),input_delai.classList.remove("noshow")}function delaiOK(){var e=parseFloat(document.getElementById("delaiSec").value).toFixed(2);celluleEnCours.innerText=e,tblDelai[delaiEnCours]=Number(e)*100,XMLHttpRequest_post("/setconfig"),dialogHide()}function dialogHide(){document.getElementById("dialog_mask").classList.add("noshow"),document.getElementById("input_delai").classList.add("noshow"),document.getElementById("input_servo").classList.add("noshow"),document.getElementById("input_position").classList.add("noshow"),document.getElementById("input_wifi").classList.add("noshow")}function swapPWM(){var e=document.getElementById("pwm1"),t=document.getElementById("pwm2"),n=e.value;e.value=t.value,t.value=n,changePlageServo("pwm1"),changePlageServo("pwm2")}function changePlageServo(e){var n=document.getElementById(e),s=Number(document.getElementById("course1").value),o=Number(document.getElementById("course2").value),i=Number(document.getElementById("pwm1").value),a=Number(document.getElementById("pwm2").value),t=document.getElementById("confRange"),r=Number(t.Value);getTestMode()==0?n.id=="course1"?s<o?t.min=n.value:t.max=n.value:n.id=="course2"&&(s<o?t.max=n.value:t.min=n.value):n.id=="pwm1"?i<a?(t.min=n.value,t.classList.remove("flip")):(t.max=n.value,t.classList.add("flip")):n.id=="pwm2"&&(i<a?(t.max=n.value,t.classList.remove("flip")):(t.min=n.value,t.classList.add("flip"))),showRangeVal(t.value)}function showRangeVal(e){document.getElementById("rangeValue").innerText=e}function changeTestMode(){if(newMode=getTestMode(),newMode!=testModeEnCours){var t,e=document.getElementById("confRange"),a=document.getElementById("rangeValue"),n=Number(document.getElementById("course1").value),s=Number(document.getElementById("course2").value),o=Number(document.getElementById("pwm1").value),i=Number(document.getElementById("pwm2").value);newMode==0?(t=remap(e.value,o,i,n,s),n<s?(e.min=n,e.max=s):(e.max=n,e.min=s),e.value=t,showRangeVal(t)):(t=remap(e.value,n,s,o,i),o<i?(e.min=o,e.max=i,e.classList.remove("flip")):(e.max=o,e.min=i,e.classList.add("flip")),e.value=t,showRangeVal(t)),testModeEnCours=newMode}}function getTestMode(){var e=document.getElementsByName("slider_option");for(i=0;i<e.length;i++)if(e[i].checked){return e[i].value;break}}function beginTouch(e,t,n){e.stopPropagation(),e.preventDefault(),beginChange(t,n)}function beginChange(e,t){var n=document.getElementById(e),s=Number(n.value);s+=t,forceInterval(n,s,Number(n.min),Number(n.max)),e=="confRange"&&showRangeVal(n.value),e=="posAdjust"&&setPosRangeVal(n.value),changeTimeoutID&&(clearTimeout(changeTimeoutID),changeTimeoutID=null),changeTimeoutID=setTimeout(function(){change(e,t)},500)}function change(e,t){var n=document.getElementById(e),s=Number(n.value);s+=t,forceInterval(n,s,Number(n.min),Number(n.max)),e=="confRange"&&showRangeVal(n.value),e=="posAdjust"&&setPosRangeVal(n.value),changeTimeoutID&&(clearTimeout(changeTimeoutID),changeTimeoutID=null),changeTimeoutID=setTimeout(function(){change(e,t)},100)}function stopTouch(e,t){e.stopPropagation(),e.preventDefault(),stopChange(t)}function stopChange(e){clearTimeout(changeTimeoutID),changeTimeoutID=null,e=="confRange"&&XMLHttpRequest_post("/servotest"),e=="posAdjust"&&XMLHttpRequest_post("/servopos")}function forceInterval(e,t,n,s){t<n&&(t=n),t>s&&(t=s),e.name=="delaiSec"?e.value=t.toFixed(2):e.value=t}function servoOK(){var t,e=Number(document.getElementById("servoNum").value),n=Number(document.getElementById("oldCourse1").value),s=Number(document.getElementById("oldCourse2").value),o=Number(document.getElementById("oldPwm1").value),i=Number(document.getElementById("oldPwm2").value);cServo[e][0]=Number(document.getElementById("course1").value),cServo[e][1]=Number(document.getElementById("course2").value),cServo[e][2]=Number(document.getElementById("pwm1").value),cServo[e][3]=Number(document.getElementById("pwm2").value);for(t=0;t<pServo[e].length;t++)pServo[e][t]=remap(pServo[e][t],n,s,cServo[e][0],cServo[e][1]),cellId="servo_"+String(e)+"_"+String(t),cellule=document.getElementById(cellId),cellule.innerText=pServo[e][t];XMLHttpRequest_post("/setservoconfig"),dialogHide()}function remap(e,t,n,s,o){return Math.round((Number(e)-Number(t))*(Number(o)-Number(s))/(Number(n)-Number(t))+Number(s))}function ws_connect(){ws==null?(location.protocol=="file:"?ws=new WebSocket("ws://"+netIP+":81"):ws=new WebSocket("ws://"+window.location.host+":81"),document.getElementById("ws_state").innerHTML="CONNECTING",ws.onopen=ws_onopen,ws.onclose=ws_onclose,ws.onmessage=ws_onmessage):ws.close()}function ws_onopen(){document.getElementById("ws_state").innerHTML="<span style='color:blue'>CONNECTED</span>"}function ws_onclose(){document.getElementById("ws_state").innerHTML="<span style='color:gray'>CLOSED</span>",ws.onopen=null,ws.onclose=null,ws.onmessage=null,ws=null}function ws_onmessage(e){e=e||window.event;const t=JSON.parse(e.data);switch(t.key){case"STATUS":status=t.value,timer_status=document.getElementById("timer_status").innerText=status,status!="PARC"?(switch_0==switch_off?document.getElementById("led0").style.backgroundImage="url(images/ledrouge.svg)":document.getElementById("led0").style.backgroundImage="url(images/ledverte.svg)",switch_1==switch_off?document.getElementById("led1").style.backgroundImage="url(images/ledrouge.svg)":document.getElementById("led1").style.backgroundImage="url(images/ledverte.svg)"):(document.getElementById("led0").style.backgroundImage="url(images/ledeteinte.svg)",document.getElementById("led1").style.backgroundImage="url(images/ledeteinte.svg)");break;case"SWITCH_0":switch_0=Number(t.value),switch_0==switch_on?document.getElementById("led0").style.backgroundImage="url(images/ledverte.svg)":document.getElementById("led0").style.backgroundImage="url(images/ledrouge.svg)";break;case"SWITCH_1":switch_1=Number(t.value),switch_1==switch_on?document.getElementById("led1").style.backgroundImage="url(images/ledverte.svg)":document.getElementById("led1").style.backgroundImage="url(images/ledrouge.svg)";break}}function showMenu(e){var t=document.getElementById("menu");t.classList.contains("noshow")?t.classList.remove("noshow"):t.classList.add("noshow"),e.stopPropagation()}function saveFile(){document.getElementById("fileSelect").click()}function openFile(){document.getElementById("saveLink").click()}function fileSelected(e){e.files.length==1&&confirm(`Recharger la configuration :
`+e.files[0].name+`
dans la minuterie ?`)&&XMLHttpRequest_post("/uploadconfig")}async function inputWifi(){apConfigChange=!1;var e=document.getElementById("apSSID"),t=document.getElementById("apPwd1"),n=document.getElementById("apPwd2");for(getVersionOK=!1,XMLHttpRequest_get("/getversion");!getVersionOK;)await sleep(100);getVersionOK=!1,e.value=ssid,t.value=pwd,dialog_mask=document.getElementById("dialog_mask"),input_delai=document.getElementById("input_wifi"),dialog_mask.classList.remove("noshow"),input_delai.classList.remove("noshow")}function updateAPconfig(){var e,t,s,o,i,n=document.getElementById("apSSID").value;if(n.length!=0&&n.length<2){alert("SSID trop court !");return}if(n.length!=0&&n.length>32){alert("SSID trop long !");return}if(t=document.getElementById("apPwd1").value,s=document.getElementById("apPwd2").value,t.length!=0||t.length!=0){if(t!==s){alert("Les mot de passe entrés ne son pas identiques !");return}if(t.length<8){alert("Mot de passe trop court !");return}if(t.length>63){alert("Mot de passe trop long !");return}}e=new XMLHttpRequest,e.onreadystatechange=function(){e.readyState==4&&(e.status==200||e.status==0?(result=e.responseXML.getElementsByTagName("result")[0].innerHTML,alert(result=="OK"?"Mise à jour de la configuration WiFi OK.":`Erreur lors de la mise à jour de la configuration WiFi :
`+result)):alert("updateAPconfig() : Error "+e.status+`
`+e.responseText))},o=encodeURIComponent(n),i=encodeURIComponent(t),location.protocol=="file:"?e.open("POST",netDevURL+"/setapconfig",!0):e.open("POST","/setapconfig",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send("ssid="+o+"&pwd="+i),dialogHide()}function toogleShowPasswd(){const e=document.getElementById("btnShowPasswd");var t=document.getElementById("apPwd1"),n=document.getElementById("apPwd2");t.type==="password"?(t.type="text",n.type="text",e.src="images/oeuil-barre.svg",e.title="Hide password"):(t.type="password",n.type="password",e.src="images/oeuil.svg",e.title="Show password")}function inputDescription(){var e=prompt(`Description de cette
configuration de minuterie :`,description);if(e!==null){if(e.length>63){alert(`Description trop longue !
(longueur maxi : 63 caractères)`);return}description=e,XMLHttpRequest_post("/setdescription")}}function escapeXML(e){var t=e,t=t.replaceAll("&","&amp;"),t=t.replaceAll('"',"&quot;"),t=t.replaceAll("'","&apos;"),t=t.replaceAll("<","&lt;"),t=t.replaceAll(">","&gt;");return t}function unescapeXML(e){var t=e,t=e.replaceAll("&amp;","&"),t=t.replaceAll("&quot;",'"'),t=t.replaceAll("&apos;","'"),t=t.replaceAll("&lt;","<"),t=t.replaceAll("&gt;",">");return t}function rd_ton_off(e){var t=document.getElementById("btn_rdt"),n=document.getElementById("rdtonoff");t.classList.contains("btn_rdt_disabled")?(t.classList.remove("btn_rdt_disabled"),n.src="images/rdton.svg"):(t.classList.add("btn_rdt_disabled"),n.src="images/rdtoff.svg"),e.stopPropagation()}function sendRDT(){var e=document.getElementById("btn_rdt");e.classList.contains("btn_rdt_disabled")||XMLHttpRequest_get("/rdt")}function doNothing(){}